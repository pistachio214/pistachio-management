import React, { useEffect } from "react";
import { AxiosResponse } from "axios";

import { Modal, Form, Input, Radio } from 'antd';
import { createRole, editRole, findRoleById } from "@/api/role";
import { SysRole } from "@/types/role";
import { Response } from "@/types/common";

interface IProps {
    isVisible: boolean
    closeModal: () => void
    id?: number
    edit?: boolean
}

const RoleEditModalComponent: React.FC<IProps> = (props: IProps) => {

    const [ form ] = Form.useForm();

    const handleOk = () => {
        const {edit} = props;
        let responseRes;
        if (edit) {
            responseRes = editRole(form.getFieldsValue())
        } else {
            responseRes = createRole(form.getFieldsValue())
        }

        responseRes.then(() => {
            handleCancel()
        })
    }

    const handleCancel = () => {
        props.closeModal();
    }

    useEffect(() => {
        const {id, edit, isVisible} = props;
        if (edit && isVisible && id !== 0) {
            //编辑
            findRoleById(id!).then((res: AxiosResponse<Response<SysRole>>) => {
                const {data} = res.data;
                form.setFieldsValue(data);
            })
        } else {
            if (isVisible) {
                form.resetFields();
            }
        }
    }, [ props.id, props.isVisible ]);  // eslint-disable-line react-hooks/exhaustive-deps

    return (
        <>
            <Modal
                title={props.edit ? "编辑角色" : "新增角色"}
                open={props.isVisible}
                onCancel={() => handleCancel()}
                onOk={() => form.submit()}
                getContainer={false}
            >

                <Form
                    name="edit-role"
                    form={form}
                    labelCol={{span: 4}}
                    wrapperCol={{span: 20}}
                    onFinish={() => handleOk()}
                    labelAlign="left"
                    autoComplete="off"
                >

                    <Form.Item
                        label="ID"
                        name="id"
                        hidden={true}
                    >
                        <Input/>
                    </Form.Item>

                    <Form.Item
                        label="角色名称"
                        name="name"
                        rules={[
                            {required: true, message: '请输入角色名称!'}
                        ]}
                    >
                        <Input placeholder="角色名称"/>
                    </Form.Item>

                    <Form.Item
                        label="唯一编码"
                        name="code"
                        rules={[
                            {required: true, message: '请输入唯一编码!'}
                        ]}
                    >
                        <Input placeholder="唯一编码"/>
                    </Form.Item>

                    <Form.Item
                        label="角色状态"
                        name="status"
                        rules={[
                            {required: true, message: '请选择角色状态!'}
                        ]}
                    >
                        <Radio.Group value={1} options={[
                            {label: '启用', value: 1},
                            {label: '禁用', value: 0}
                        ]}>
                        </Radio.Group>
                    </Form.Item>

                    <Form.Item
                        label="描述"
                        name="remark"
                        rules={[
                            {required: true, message: '请输入角色描述!'}
                        ]}
                    >
                        <Input.TextArea rows={4} placeholder="角色描述"/>
                    </Form.Item>

                </Form>
            </Modal>
        </>
    );
}

RoleEditModalComponent.defaultProps = {
    isVisible: false,
    id: 0,
    edit: true
}

export default RoleEditModalComponent;